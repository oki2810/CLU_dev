<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ココフォリアログアップローダー (CCU)</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      #main-container {
        width: 90%;
        max-width: 700px;
        margin: 0 auto;
      }
    html {
      font-size: 100%;
    }
    @media (max-width: 576px) {
      html {
        font-size: 87.5%; /* 16px * 0.875 = 14px */
      }
    }
  </style>
  </head>
  <body>
    <div id="main-container" class="container py-5">
      <h1 class="mb-4">ココフォリアログアップローダー (CCU)</h1>
      <p>
        ローカルの log.html を検索除外タグ付きで整形し、
        GitHub リポジトリにコミットできるツールです。
      </p>

      <ul class="nav nav-tabs mb-4" id="tabNav">
        <li class="nav-item">
          <button class="nav-link active" id="tabCCU" type="button">CCU</button>
        </li>
        <li class="nav-item">
          <button class="nav-link" id="tabUsage" type="button">使い方</button>
        </li>
      </ul>

      <div id="ccuContent">

      <!-- ① GitHub連携セクション -->
      <div class="card mb-4">
        <div class="card-header">① GitHub 連携</div>
        <div class="card-body">
          <!-- 未連携時 -->
          <div id="authSection">
            <button id="githubConnectBtn" class="btn btn-dark">
              GitHub と連携
            </button>
          </div>

          <!-- 連携済み時: ユーザー名＋解除ボタンを横並び -->
          <div
            id="loginPanel"
            class="align-items-center mt-2 mb-3"
            style="display: none;"
          >
            <span id="loginInfo" class="me-2"></span>
            <button
              id="githubDisconnectBtn"
              class="btn btn-outline-danger"
            >
              GitHub 連携解除
            </button>
          </div>

          <!-- リポジトリ名入力＋初期設定ボタン＋ステータス -->
          <div id="repoSettings" style="display: none;">
            <div class="mb-3">
              <input
                type="text"
                id="repoInput"
                class="form-control"
                placeholder="リポジトリ名"
              />
            </div>
            <input type="hidden" id="pathInput" value="log/test.html" />
            <button
              id="useExistingBtn"
              class="btn btn-outline-primary mb-2 me-2"
            >
              既存リポジトリを使用
            </button>
            <button
              id="createAndInitBtn"
              class="btn btn-success mb-2"
            >
              初期設定
            </button>
            <!-- 完了メッセージ出力先 -->
            <div id="initStatus" class="mt-2"></div>
          </div>
        </div>
      </div>

      <!-- ② HTML整形・アップロードセクション -->
      <div class="card mb-4">
        <div class="card-header">② HTML 整形・アップロード</div>
        <div class="card-body">
          <div class="mb-3">
            <label for="uploadHtml" class="form-label"
              >整形したい HTML をアップロード</label
            >
            <input
              class="form-control"
              type="file"
              id="uploadHtml"
              accept=".html"
            />
          </div>
          <div class="mb-3">
            <label for="filenameInput" class="form-label">シナリオ名</label>
            <input
              type="text"
              id="filenameInput"
              class="form-control"
              placeholder="例: サンプルシナリオ"
            />
          </div>
          <div class="mb-3">
            <label for="linknameInput" class="form-label">リンク名</label>
            <input
              type="text"
              id="linknameInput"
              class="form-control"
              pattern="[0-9A-Za-z]*"
              title="半角英数字のみ"
              placeholder="例: samplescenario"
            />
          </div>
          <button id="formatBtn" class="btn btn-secondary me-2">修正</button>
          <button id="githubUploadBtn" class="btn btn-primary me-2">
            GitHub にコミット
          </button>
          <button
            id="viewProjectBtn"
            class="btn btn-secondary"
            style="display: none;"
          >
            ログ一覧ページを開く
          </button>
          <pre
            id="formattedOutput"
            class="mt-3 border p-3"
            style="height: 150px; overflow: auto;"
          ></pre>
          <div id="githubStatus" class="mt-2"></div>
        </div>

      </div>
      <!-- /#ccuContent -->
      </div>

      <div id="usageContent" style="display: none;">
        <div class="card mb-4">
        <div class="card-body">
            <h2 class="h4 mb-3">使い方</h2>

            <h3 class="h5 mt-4">はじめに</h3>
            <p>ここでは検索避けをした状態でログページを公開するアプリ、CCUの使い方を紹介します。</p>
            <hr />

            <h3 class="h5 mt-4">1. GitHubアカウントの準備</h3>
            <ol>
              <li>
                <a href="https://github.com" target="_blank" rel="noopener"
                  >GitHub</a
                > にアクセスし、新規アカウントを作成します。
                <ul>
                  <li>
                    メールアドレスとパスワードを登録し、メール認証を済ませてください。
                  </li>
                </ul>
              </li>
            </ol>
            <hr />

            <h3 class="h5 mt-4">2. GitHubとツールの連携</h3>
            <h4 class="h6 mt-3">初回の設定</h4>
            <ol>
              <li>本ツール画面で「GitHub と連携」ボタンをクリック。</li>
              <li>GitHub 側で認可画面が開くので、アクセスを許可します。</li>
              <li>
                初期設定画面が表示されたら、任意のリポジトリ名を入力し、「初期
                設定」ボタンを押します。
                <ul>
                  <li>
                    リポジトリ名は何でも OK（例：<code>my-log-page</code>）
                  </li>
                </ul>
              </li>
              <li>
                「初期設定が完了しました！」と出たら、その下にあるリンクを
                クリックしてGitHub側の設定画面へ移動。
              </li>
              <li>
                「Build and deployment」セクションにある
                <ul>
                  <li>
                    <strong>Branch</strong> の項目を <code>none</code> →
                    <code>main</code> に変更
                  </li>
                  <li><strong>Save</strong> ボタンで保存</li>
                </ul>
              </li>
              <li>
                画面上部が「main ▼」 「 / (root) 」 「Save（グレー）」と表示されていれば設定完了です。
              </li>
              <li>
                現在上から二段目にあるタブ一覧で<strong>Setting</strong>にいるので、一番左の<strong>Code</strong> を開き、
                <ul>
                  <li>画面やや下、本のマークがついている<code>README</code> の右にある鉛筆マークをクリックして</li>
                  <li>
                    テキスト欄に <code>ok</code> と入力 → <strong>Commit Change</strong>を押します。<br>ポップアップが表示されたら何も変更せず<strong>
                      Commit Change</strong
                    >を押してください。
                  </li>
                </ul>
              </li>
              <li>CCUに戻ります。</li>
            </ol>
            <h4 class="h6 mt-3">2回目以降の設定</h4>
            <ol>
              <li>本ツール画面で、以前に設定したリポジトリ名を入力。</li>
              <li>「既存リポジトリを使用」ボタンを押すだけでOK。</li>
            </ol>
            <hr />

            <h3 class="h5 mt-4">3. HTMLファイルのアップロード</h3>
            <ol>
              <li>
                整形したいHTMLファイルを選択。
                <ul>
                  <li>
                    ココフォリア標準出力のHTML、または以下の外部ツールで加工したHTMLも利用可。
                    <ul>
                      <li>
                        <a
                          href="https://kanonn.chips.jp/converterV2/"
                          target="_blank"
                          rel="noopener"
                          >ココフォリアログ変換ツール</a
                        >
                      </li>
                      <li>
                        <a
                          href="https://log-formatter.herokuapp.com/dark"
                          target="_blank"
                          rel="noopener"
                          >Ccfolia Log Formatter</a
                        >
                      </li>
                      <li>
                        <a
                          href="https://inouemoku.github.io/mochimochi/"
                          target="_blank"
                          rel="noopener"
                          >MochiMochi - ココフォリアログ整形ツール</a
                        >
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li>
                シナリオ名（日本語可）とリンク名（半角英数字のみ）を入力し、「修正」ボタンを押します。
              </li>
              <li>
                画面下部に整形済みデータが出力されるのを確認したら、「GitHubにコミット」ボタンでアップロード。
              </li>
              <li>
                コミット後、公開まで約5分かかります。
                <ul>
                  <li>
                    しばらく待ってから「ログ一覧ページを開く」リンクをクリックし、正常に反映されているか確認。
                  </li>
                </ul>
              </li>
              <li>
                完了したログ一覧ページはブラウザのブックマークに登録しておくと、
                いつでもアクセスできます。
              </li>
            </ol>

            <hr />

            <h3 class="h5 mt-4">4. GitHubからのメール通知をオフにする</h3>
            <ol>
              <li>
                GitHub（<a href="https://github.com" target="_blank" rel="noopener">github.com</a>）にログインし、
                画面右上のプロフィール写真をクリック。
              </li>
              <li>
                メニューから <strong>Settings</strong>（設定）をクリック。
              </li>
              <li>
                左側のメニューから <strong>Notifications</strong>（通知）を選択。
              </li>
              <li>
                <strong>Email notification preferences</strong> の項目で、
                <ul>
                  <li>
                    「Watching」「Participating」「Mention」など、受け取りたくない種類のチェックを外す。
                  </li>
                </ul>
              </li>
              <li>
                ページ下部の <strong>Update notification settings</strong>（通知設定を更新）ボタンをクリックして保存。
              </li>
            </ol>
          </div>
        </div>
      </div>

    </div>

    <!-- アプリケーション JS -->
    <script src="app.js"></script>
    <!-- norobot.js (SEO除外スクリプト) -->
    <script src="norobot.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
